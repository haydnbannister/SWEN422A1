<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>

<body>
<!-- load the d3.js library -->
<script src="//d3js.org/d3.v4.min.js"></script>

<div id="viz"></div>

<script type="text/javascript">

    let sampleSVG;

    function animate() {
        let col = d3.select(this).style("fill");
        let size = d3.select(this).attr("r");

        let string = "#"+d3.select(this).attr("arcs");

        d3.selectAll(string)
            .transition()
            .style("opacity", 0);

        d3.select(this).transition()
            .duration(250)
            .attr("r", 150)
            .attr("col", col)
            .attr("ogsize", size)
            .style("fill", "white");

        d3.select(this).on("mouseout", animateOut);
        text(d3.select(this));
    }

    function animateOut(){
        var string = "#"+d3.select(this).attr("arcs");

        d3.select(this)
            .transition()
            .delay(1000)
            .attr("r", d3.select(this).attr("ogsize"))
            .style("fill", d3.select(this).attr("col"));

        d3.selectAll("#open")
            .transition()
            .delay(1000)
            .style("opacity", 0)
            .remove();

        d3.selectAll(string)
            .transition()
            .delay(1150)
            .style("opacity", 1);
    }

    function whoWon(name){
        if(name === "Central Pulse" ||
            name === "Northern Mystics" ||
            name === "Waikato Bay of Plenty Magic" ||
            name === "Southern Steel" ||
            name === "Canterbury Tactix"){
            return "NZ";
        }
        else{
            return "AUS";
        }
    }

    function text(circle){
        var x = circle.attr("cx");
        var y = circle.attr("cy");
        var w = 0;
        sampleSVG.append("text")
            .text(circle.attr("home"))
            .attr("id", "open")
            .style("font-family", "Helvetica Neue")
            .attr("dy", (+y))
            .each(function(){
                w = this.getComputedTextLength(); return w;
            })
            .attr("dx", (+x) - (w/2));
    }

    function findColour(name){
        if(name === "Central Pulse"){
            return("#3366cc");
        }
        if(name === "Northern Mystics"){
            return("#dc3912");
        }
        if(name === "Waikato Bay of Plenty Magic"){
            return("#ff9900");
        }
        if(name === "Southern Steel"){
            return("#0099c6");
        }
        if(name === "Canterbury Tactix"){
            return("#B7A76A");
        }
        if(name === "New South Wales Swifts"){
            return("#66aa00");
        }
        if(name === "Adelaide Thunderbirds"){
            return("#B70013");
        }
        if(name === "Melbourne Vixens"){
            return("#316395");
        }
        if(name === "West Coast Fever"){
            return("#990099");
        }
        if(name === "Queensland Firebirds"){
            return("#3b9eac");
        }
        else return("#6633cc")
    }

    // function jiggle(){
    //     const x = d3.select(this).attr("cx");
    //
    //     d3.select(this)
    //         .transition()
    //         .duration(100)
    //         .attr("cx", (+x + 10))
    //         .transition()
    //         .duration(100)
    //         //.delay(250)
    //         .attr("cx", (+x));
    // }

    d3.csv("data/2008-Table1.csv", function (error, data) {
        let xwidth = 1;
        let ywidth = 3;
        let index = 1;
        let row = 1;
        let rowIndex = 0;
        let title = "2008 ANZ Championship Matches";

        if (error) throw error;

        sampleSVG = d3.select("#viz")
            .append("svg")
            .attr("width", 1500)
            .attr("height", 5250);

        sampleSVG.append("text")
            .text(title)
            .attr("dx", 10)
            .attr("dy", 50)
            .style("font-size", 50)
            .style("font-family", "Helvetica Neue")
            .style("fill", "gray");

        var allPoint = 0;
        var max = 0;

        data.forEach(function (d) {
            d.Score1 = +d.Score1;
            d.Score2 = +d.Score2;
            allPoint = d.Score1+d.Score2;
            if(allPoint > max){
                max = allPoint;
            }
        });

        var arcIndex = 0;
        data.forEach(function (d) {
            var col = "white";
            if(whoWon(d["Home Team"]) === "NZ" && (d.Score1 > d.Score2)){
                col = "silver";
            }
            else if(whoWon(d["Away Team"]) === "NZ" && (d.Score2 > d.Score1)){
                col = "silver";
            }
            else if(whoWon(d["Home Team"]) === "AUS" && (d.Score1 > d.Score2)){
                col = "gold";
            }
            else if(whoWon(d["Away Team"]) === "AUS" && (d.Score2 > d.Score1)){
                col = "gold";
            }

            var total = (d.Score1)+(d.Score2);
            var linearScale = d3.scaleLinear()
                .domain([0,total])
                .range([0,360]);
            var bubbleSize = d3.scaleLinear()
                .domain([0,max])
                .range([0,100]);

            var bubSize = bubbleSize(total);
            var rad = (bubSize);
            //console.log(bubSize);

            sampleSVG.append("circle")
                .style("stroke", "gray")
                .style("fill", col)
                .attr("r", rad)
                .attr("cx", xwidth*200)
                .attr("cy", ywidth*75)
                .attr("arcs", "arc"+arcIndex)
                .attr("home", d["Home Team"])
                .attr("away", d["Away Team"])
                .on("mousedown", animate);

            var arc = d3.arc()
                .innerRadius(rad-30)
                .outerRadius(rad)
                .startAngle(270*(Math.PI/180))
                .endAngle((270+linearScale(d.Score1))*(Math.PI/180));

            sampleSVG
                .append("path")
                .attr("id", "arc"+arcIndex)
                .attr("d", arc)
                .attr("fill", findColour(d["Home Team"]))
                .attr("transform", "translate("+xwidth*200+","+ywidth*75+")");

            var arc2 = d3.arc()
                .innerRadius(rad-30)
                .outerRadius(rad)
                .startAngle((270+linearScale(d.Score1))*(Math.PI/180))
                .endAngle((270+linearScale(d.Score1)+linearScale(d.Score2))*(Math.PI/180));

            sampleSVG
                .append("path")
                .attr("id", "arc"+arcIndex)
                .attr("d", arc2)
                .attr("fill", findColour(d["Away Team"]))
                .attr("transform", "translate("+xwidth*200+","+ywidth*75+")");

            arcIndex++;
            xwidth++;
            rowIndex++;
            index++;

            row = Math.round(index/5);

            if(index <= 70 && rowIndex === 5){
                sampleSVG.append("line")
                    .attr("x1", 75)
                    .attr("x2", 1250)
                    .attr("y1", (ywidth*75)+150)
                    .attr("y2", (ywidth*75)+150)
                    .style("strokeWidth", "20px")
                    .style("stroke", "#000");

                sampleSVG.append("text")
                    .text(row)
                    .attr("dx", 20)
                    .attr("dy", (ywidth*75)+15)
                    .style("font-size", 50)
                    .style("font-family", "Helvetica Neue")
                    .style("fill", "gray");
                rowIndex = 0;
                ywidth += 4;
                xwidth = 1;
            }
            if(index === 71){
                sampleSVG.append("line")
                    .attr("x1", 75)
                    .attr("x2", 1250)
                    .attr("y1", (ywidth*75)+150)
                    .attr("y2", (ywidth*75)+150)
                    .style("strokeWidth", "20px")
                    .style("stroke", "#000");

                sampleSVG.append("text")
                    .text(row)
                    .attr("dx", 20)
                    .attr("dy", (ywidth*75)+15)
                    .style("font-size", 50)
                    .style("font-family", "Helvetica Neue")
                    .style("fill", "gray");
                ywidth += 4;
                xwidth = 1;

            }
            if(index === 73){
                row = 15;
                sampleSVG.append("line")
                    .attr("x1", 75)
                    .attr("x2", 1250)
                    .attr("y1", (ywidth*75)+150)
                    .attr("y2", (ywidth*75)+150)
                    .style("strokeWidth", "20px")
                    .style("stroke", "#000");

                sampleSVG.append("text")
                    .text(row)
                    .attr("dx", 20)
                    .attr("dy", (ywidth*75)+15)
                    .style("font-size", 50)
                    .style("font-family", "Helvetica Neue")
                    .style("fill", "gray");
                ywidth += 4;
                xwidth = 1;
            }
            if(index === 74){
                row = 16;
                sampleSVG.append("line")
                    .attr("x1", 75)
                    .attr("x2", 1250)
                    .attr("y1", (ywidth*75)+150)
                    .attr("y2", (ywidth*75)+150)
                    .style("strokeWidth", "20px")
                    .style("stroke", "#000");

                sampleSVG.append("text")
                    .text(row)
                    .attr("dx", 20)
                    .attr("dy", (ywidth*75)+15)
                    .style("font-size", 50)
                    .style("font-family", "Helvetica Neue")
                    .style("fill", "gray");
                ywidth += 4;
                xwidth = 1;
            }
            if(index === 75){
                row = 17;
                sampleSVG.append("line")
                    .attr("x1", 75)
                    .attr("x2", 1250)
                    .attr("y1", (ywidth*75)+150)
                    .attr("y2", (ywidth*75)+150)
                    .style("strokeWidth", "20px")
                    .style("stroke", "#000");

                sampleSVG.append("text")
                    .text(row)
                    .attr("dx", 20)
                    .attr("dy", (ywidth*75)+15)
                    .style("font-size", 50)
                    .style("font-family", "Helvetica Neue")
                    .style("fill", "gray");
                ywidth += 4;
                xwidth = 1;
            }
        });
    });

</script>
</body>
</html>